<script src="//www.kth.se/social/toolbar/widget.js"></script>
<script src="//momentjs.com/downloads/moment.min.js"></script>

<h1>CD Pipeline Deployments</h1>

{{#if error}}
<div aria-live="polite" role="alert" class="alert alert-danger">
      <p><strong>Opps this is not suppose to happen...</strong></p>
      <p>{{error}}</p>
  </div>
{{else}}

<p>These are the services developted by the KTH IT-department using our CD pipeline. (These are not all our services :) </p>

<h2>Is something not working?</h2>
<p>All our services are monitored, see <a href="https://www.kthstatus.se/">the current services status here</a>.</p>
<p>For more information about larger outages, please look at the <a href="https://www.kth.se/en/gemensamt/driftsinformation-webbtjanster/ug-rss">IT-Support pages.</a></p>

<table id="deployments">

  <thead>
    <tr>
      <th>Application</th>
      <th>Path</th>
      <th>Updated</th>
      <th>Contact</th>
    </tr>
  </thead>

  <tbody>

    {{#each data}}
    <tr>
      {{#if this.publicNameEnglish}}
      <td class="applicationName"><a href="#irt"><span title="Incident Response Time: {{this.importance}}" class="importance {{this.importance}}"></span></a> <a href="#{{this.applicationName}}">{{this.publicNameEnglish}}</a></td>
    {{else}}
      <td class="applicationName"><a href="#irt"><span title="Incident Response Time: {{this.importance}}" class="importance {{this.importance}}"></span></a> <a href="#{{this.applicationName}}">{{this.applicationName}}</a></td>
    {{/if}}
      {{#if this.monitorUrl}}
        <td class="path"><a href="{{this.monitorUrl}}">{{this.path}}</a></td>
      {{else}}
        <td class="path"><a href="https://app.kth.se{{this.path}}">{{this.path}}</a></td>
      {{/if}}
      <td class="created"><span id="created{{@index}}">{{this.created}}</span></td>
      <td class="slackChannels">{{this.slackChannels}}</td>
    </tr>
    <script>
      
      document.getElementById("created{{@index}}").innerHTML = moment.unix({{this.created}}).fromNow()

    </script>

    {{/each}}

  </tbody>
</table>

<a name="irt"></a>
<h2>Incident Response Time</h2>
  <p>
    The coloured circles is a classification of the importance of each service.
    It indicates how fast the Operations or Support team start working on the service incase of an outage.
  </p>

<div aria-live="polite" role="alert" class="alert alert-info">

  <p>
    <span class="importance high"></span> High <span class="alert-info-text" >- Actively monitored by operations personal during office hours. Operations are on call until midnight. Action to bring back the service is normally taken within 15 minutes.</span><br/>
    <span class="importance medium"></span> Medium <span class="alert-info-text" >- Actively monitored by operations personal during office hours. The service is normally back within 2 hours, or the following morning.</span><br/>
    <span class="importance low"></span> Low <span class="alert-info-text" >- The service is normally back within a day.</span><br/>
  </p>
</div>


<h2>Extended information about the listed services</h2>
{{#each data}}

<div class="application">
  <a name="{{this.applicationName}}"></a>
  {{#if this.publicNameEnglish}}
   <h3>{{this.publicNameEnglish}} <span class="applicationName"> - {{this.applicationName}}</span></h3> 
  {{else}}
    <h3>{{this.applicationName}}</h3> 
  {{/if}}

  {{#if this.publicNameSwedish}}
    <strong>Svenskt namn:</strong> {{this.publicNameSwedish}}<br /> 
  {{/if}}

  {{#if this.descriptionEnglish }}
    <p>{{this.descriptionEnglish}} </p>
  {{/if}}

  <strong>Website:</strong>  {{#if this.monitorUrl}}<a href="{{this.monitorUrl}}">{{this.monitorUrl}}</a> {{else}} <a href="https://app.kth.se{{this.path}}">https://app.kth.se{{this.path}}</a> {{/if}}<br />
  <strong>Version: </strong>: {{this.version}}<br/>
  {{#if this.importance}}
    <strong>Incident Response Time:</strong> <span title="Application importance: {{this.importance}}" class="importance {{this.importance}}"></span> {{this.importance}}<br/>
  {{/if}}
  {{#if this.slackChannels}}
    <strong>Responsible team: </strong>{{this.slackChannels}} <br/>
  {{/if}}

  <hr />
</div>
{{/each}} {{/if}}


<script>
  $(function () {
    // Only run sort script on big screen devices
    var boostrapTabletBreakpoint = 768
    if ($(window).width() > boostrapTabletBreakpoint) {
      $('#deployments').DataTable({
        paging: false,
        info: false,
        searching: false,
        order: [[0, 'asc']],
        columnDefs: []
      })
    }
  })
</script>